<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width" name="viewport"/>
  <link href="/8bitcc.ico" rel="icon" type="image/png"/>
  <link href="https://waylonwalker.com/named-tuples-data-science/amp/" rel="amphtml"/>
  <meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization" property="monetization"/>
  <!-- <link rel='stylesheet' href='/fonts.css' />
  <link rel='stylesheet' href='/archive-styles.css' />
  <link rel='stylesheet' href='/article.css' /> -->
  <link href="/main.min.css" rel="stylesheet"/>
  <link as="style" href="/one-dark.min.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload"/>
  <link as="style" href="/furo-purge.min.css" onload="this.onload=null;this.rel='stylesheet'" rel="preload"/>
  <!-- <link rel="preload" href="/scroll.css" as="style" onload="this.onload=null;this.rel='stylesheet'"> -->
  <noscript>
   <!-- <link rel='stylesheet' href='/scroll.css' /> -->
   <link href="/one-dark.min.css" rel="stylesheet"/>
   <link href="/furo-purge.min.css" rel="stylesheet"/>
  </noscript>
  <link href="8bitcc_48x48.png" rel="apple-touch-icon" sizes="48x48"/>
  <link href="8bitcc_72x72.png" rel="apple-touch-icon" sizes="72x72"/>
  <link href="8bitcc_96x96.png" rel="apple-touch-icon" sizes="96x96"/>
  <link href="8bitcc_144x144.png" rel="apple-touch-icon" sizes="144x144"/>
  <link href="8bitcc_192x192.png" rel="apple-touch-icon" sizes="192x192"/>
  <link href="8bitcc_256x256.png" rel="apple-touch-icon" sizes="256x256"/>
  <link href="8bitcc_384x384.png" rel="apple-touch-icon" sizes="384x384"/>
  <link href="8bitcc_512x512.png" rel="apple-touch-icon" sizes="512x512"/>
  <title>
   Clean up Your Data Science with Named Tuples
  </title>
  <meta content="article" name="og:type" property="og:type"/>
  <meta content="Waylon Walker" name="og:author" property="og:author"/>
  <meta content="Waylon Walker" name="og:site_name" property="og:site_name"/>
  <meta content="#322D39" name="theme-color"/>
  <meta content="Waylon Walker" name="og:author" property="og:author"/>
  <meta content="waylon@waylonwalaker.com" name="og:author_email" property="og:author_email"/>
  <meta content="website" name="og:type" property="og:type"/>
  <meta content="If you are a regular listener of  As you graduate your scripts into modules and libraries you might start to notice that you need to pass a lot of data around t" name="description" property="description"/>
  <meta content="If you are a regular listener of  As you graduate your scripts into modules and libraries you might start to notice that you need to pass a lot of data around t" name="og:description" property="og:description"/>
  <meta content="If you are a regular listener of  As you graduate your scripts into modules and libraries you might start to notice that you need to pass a lot of data around t" name="twitter:description" property="twitter:description"/>
  <meta content="Clean up Your Data Science with Named Tuples | Waylon Walker" name="og:title" property="og:title"/>
  <meta content="Clean up Your Data Science with Named Tuples | Waylon Walker" name="twitter:title" property="twitter:title"/>
  <meta content="https://images.waylonwalker.com/named-tuples-data-science-og.png" name="og:image" property="og:image"/>
  <meta content="https://images.waylonwalker.com/named-tuples-data-science-og.png" name="twitter:image" property="twitter:image"/>
  <meta content="1600" name="og:image:width" property="og:image:width"/>
  <meta content="900" name="og:image:width" property="og:image:width"/>
  <meta content="summary_large_image" name="twitter:card" property="twitter:card"/>
  <meta content="Waylon Walker" name="og:site_name" property="og:site_name"/>
  <meta content="@_waylonwalker" name="twitter:creator" property="twitter:creator"/>
  <meta content="Clean up Your Data Science with Named Tuples" name="title" property="title"/>
  <meta content="markata 0.1.0" name="generator" property="generator"/>
  <link href="https://waylonwalker.com/named-tuples-data-science/" rel="canonical"/>
  <meta content="https://waylonwalker.com/named-tuples-data-science/" name="og:url" property="og:url"/>
  <link href="/manifest.json" rel="manifest"/>
  <meta content="https://images.waylonwalker.com/named-tuples-data-science-og_250x140.png" name="og:sm_image" property="og:sm_image"/>
  <meta content="https://images.waylonwalker.com/named-tuples-data-science-og_250x140.png" name="og:sm_image" property="og:sm_image"/>
 </head>
 <body>
  <nav>
   <ul>
    <li>
     <a href="/">
      Home
     </a>
    </li>
    <li>
     <a href="/archive/">
      Archive
     </a>
    </li>
    <li>
     <a aria-label="RSS" href="/rss.xml">
      <svg class="icon" height="16" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
       <path d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64" fill="currentColor">
       </path>
      </svg>
     </a>
    </li>
   </ul>
  </nav>
  <article class="blog-post h-entry">
   <!-- <div id='cover-wrapper'>
      <img src='/named-tuples-data-science.webp' alt='cover image for article' />
    </div> -->
   <div id="title-wrapper">
    <a class="u-url" href="https://waylonwalker.com/named-tuples-data-science/">
     <h1 class="flair" id="title" style="text-align:right;z-index:2;padding-right:.2rem">
      Clean up Your Data Science with Named Tuples
     </h1>
    </a>
    <p>
     <time class="dt-published post-date" datetime="2019-09-11" style="text-align:right;z-index:2">
      2019-09-11
     </time>
    </p>
    <div class="h-card p-author" rel="author">
     <div class="content">
      <a class="p-name u-url" href="https://waylonwalker.com/">
       <p>
        <span class="p-given-name">
         Waylon
        </span>
        <span class="p-family-name">
         Walker
        </span>
       </p>
      </a>
      <p class="p-note">
       Learning in Public
       <a href="https://twitter.com/_WaylonWalker">
        @_WaylonWalker
       </a>
      </p>
     </div>
    </div>
    <!-- edit -->
    <p>
     <a alt="edit post url" href="https://github.com/WaylonWalker/waylonwalker.com/edit/main/pages/blog/named-tuples-data-science.md" title="edit this post">
      edit
      <span aria-label="" role="img">
       ‚úèÔ∏è
      </span>
     </a>
    </p>
   </div>
   <!-- <h2 class='toc'>toc</h2> -->
   <!-- <div class="toc">
<ul>
<li><a href="#its-still-early">It's still early</a></li>
<li><a href="#on-to-the-devtools">On to the devtools</a></li>
<li><a href="#why-does-textual-need-its-own-devtools">Why does textual need its own devtools</a></li>
<li><a href="#getting-the-css-branch">getting the css branch</a></li>
<li><a href="#install-in-a-virtual-environment">install in a virtual environment</a></li>
<li><a href="#now-that-we-have-textual-installed">Now that we have textual installed</a></li>
</ul>
</div>
 -->
   <div id="post-body">
    <p>
     If you are a regular listener of
     <a href="https://talkpython.fm">
      TalkPython
     </a>
     or PythonBytes you have hear Michael Kennedy talk about Named Tuples many times, but what are they and how do they fit into my data science workflow.
    </p>
    <h2 id="example">
     Example
     <a alt="id" class="heading-permalink" href="#example" title="link to #example">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h2>
    <p>
     As you graduate your scripts into modules and libraries you might start to notice that you need to pass a lot of data around to all of the functions that you have created. For example if you are running some analysis utilizing
     <code>
      sales
     </code>
     ,
     <code>
      inventory
     </code>
     , and
     <code>
      pricing
     </code>
     data.  You may need to calculate total revenue, inventory on hand.  You may need to pass these data sets into various models to drive production or pricing based on predicted volumes.
    </p>
    <h2 id="load-data">
     Load data
     <a alt="id" class="heading-permalink" href="#load-data" title="link to #load-data">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h2>
    <p>
     Here we setup functions that can load data from the sales database.  Assume that we also have similar functions to
     <code>
      get_inventory
     </code>
     and
     <code>
      get_pricing
     </code>
     .
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">get_engine</span><span class="p">():</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'postgresql://scott:tiger@localhost:5432/mydatabase'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_sales</span><span class="p">():</span>
    <span class="sd">'''</span>
<span class="sd">    gets sales history from the sales database</span>
<span class="sd">    '''</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">get_engine</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s1">'''select * from sales.history'''</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
    <span class="n">engine</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">get_inventory</span><span class="p">():</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">get_pricing</span><span class="p">():</span>
    <span class="o">...</span>
</code></pre>
    </div>
    <h3 id="create-metrics">
     Create Metrics
     <a alt="id" class="heading-permalink" href="#create-metrics" title="link to #create-metrics">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h3>
    <p>
     Here we create our first function to calculate some metrics.  There are likely many of these functions that repeat a similar pattern.  They use similar data and have their own custom logic for calculations and joins.
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">calculate_total_revenue</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">):</span>
    <span class="sd">"""calculates the total sales revenue for all of company XYZ"""</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pricing</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'sku'</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">'sku'</span><span class="p">)</span>
    <span class="n">sales</span><span class="p">[</span><span class="s1">'revenue'</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'qty'</span><span class="p">]</span> <span class="o">*</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'price'</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'revenue'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">calculate_inventory_sale_ratio</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">pricing</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">calculate_inventory_sale_ratio</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="n">sales</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre>
    </div>
    <p>
     Furthermore these functions will need to be called somewhere, this might be in a
     <code>
      make_report()
     </code>
     function that puts this data into an html template to be sent out to stakeholders, or to be served on a website. Notice how we have the same data showing up time and time again.  And sometimes we even ask for it in a different order üò≤.It is important to recognize this early in the project before this gets our of hand.
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">make_report</span><span class="p">():</span>
    <span class="sd">"""Makes stakeholder report for company XYZ"""</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="n">get_sales</span><span class="p">()</span>
    <span class="n">inventory</span> <span class="o">=</span> <span class="n">get_inventory</span><span class="p">()</span>
    <span class="n">pricing</span> <span class="o">=</span> <span class="n">get_pricing</span><span class="p">()</span>

    <span class="n">revenue</span> <span class="o">=</span> <span class="n">calculate_total_revenue</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">)</span>
    <span class="n">sales_ratio</span> <span class="o">=</span> <span class="n">inventory_sale_ratio</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">pricing</span><span class="p">)</span>
    <span class="n">inventory_sale_ratio</span><span class="p">(</span><span class="n">inventory</span><span class="p">,</span> <span class="n">sales</span><span class="p">)</span>
</code></pre>
    </div>
    <h3 id="getting-out-of-hand">
     getting out of hand
     <a alt="id" class="heading-permalink" href="#getting-out-of-hand" title="link to #getting-out-of-hand">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h3>
    <p>
     Along the way our features, models, and out supervisors have all had their own needs and we have added new datasets, and several flags. This is the point at which anxiety starts creeping in.  We start spending a lot of time double checking the order of each call to make sure that we dont make a mistake.  And when someone else touches this model, we know what it looks like and cant help but think, "Oh God I hope they didn't screw up that horrid module!"
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">calculate_total_revenue</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">):</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="p">(</span><span class="n">sales</span>
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pricing</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'sku'</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">'sku'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">inventory</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'sku'</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">'sku'</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="n">sales</span><span class="p">[</span><span class="s1">'revenue'</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'qty'</span><span class="p">]</span> <span class="o">*</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'price'</span><span class="p">]</span>
    <span class="n">sales</span>  <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">'price &gt; </span><span class="si">{</span><span class="n">min_price</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">sales</span>  <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">'sale_date &gt; </span><span class="si">{</span><span class="n">min_date</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">sales</span>  <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">'sale_date &lt; </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'revenue'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">calculate_inventory_sale_ratio</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">calculate_inventory_sale_ratio</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">model_new_prices</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">model_production</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">):</span>
    <span class="o">...</span>

<span class="k">def</span> <span class="nf">completely_custom_metric_for_steve</span><span class="p">(</span><span class="n">sales</span><span class="p">,</span> <span class="n">pricing</span><span class="p">,</span> <span class="n">inventory</span><span class="p">,</span> <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">):</span>
    <span class="sd">"""Steve has been here 30 years and doesnt trust our metrics unless he can validate against the old metrics"""</span>
    <span class="o">...</span>
</code></pre>
    </div>
    <p>
     It gets even crazier when you start calling all of these functions! Note that we have a common theme of the same data getting passed into
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">make_report</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">,</span> <span class="n">is_for_steve</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Makes stakeholder report for company XYZ"""</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="n">get_sales</span><span class="p">()</span>
    <span class="n">inventory</span> <span class="o">=</span> <span class="n">get_inventory</span><span class="p">()</span>
    <span class="n">pricing</span> <span class="o">=</span> <span class="n">get_pricing</span><span class="p">()</span>

    <span class="n">revenue</span> <span class="o">=</span> <span class="n">calculate_total_revenue</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">)</span>
    <span class="n">sales_ratio</span> <span class="o">=</span> <span class="n">sales_ratio</span> <span class="o">=</span> <span class="n">inventory_sale_ratio</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">)</span>
    <span class="n">inventory_sale_ratio</span> <span class="o">=</span> <span class="n">inventory_sale_ratio</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">)</span>
    <span class="n">predicted_prices</span> <span class="o">=</span> <span class="n">model_new_prices</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">)</span>
    <span class="n">predicted_production_rates</span> <span class="o">=</span> <span class="n">model_production_rate</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">)</span>
    <span class="n">completely_custom_metric_for_steve</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">)</span>

    <span class="c1"># render report</span>
    <span class="o">...</span>
</code></pre>
    </div>
    <h3 id="this-code-stinks">
     This code Stinks
     <a alt="id" class="heading-permalink" href="#this-code-stinks" title="link to #this-code-stinks">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h3>
    <p>
     ‚åö
     <em>
      Time for refactoring
     </em>
    </p>
    <p>
     While our code started out good it has grown stinky over time.  It will works fine, but it could be better and more enjoyable to work with.  What we have here is a code smell called
     <code>
      data clump
     </code>
     .  This is a group of data that always appears together.  It would be appropriate to formally group this data together.  One way to do this in python is to use nametuples.  It is a very simple technique that allows us to define a data structure that contains a specific set of attributes that we can access using
     <code>
      .attribute_name
     </code>
     .  Replacing this
     <code>
      data clump
     </code>
     with a formal group of data will allow us to reduce the number of arguments in all of our functions. Add new attributes easily. And not rely on positional arguments.  This code will be easier to maintain, read, and write.
    </p>
    <blockquote>
     <p>
      What we have here is a code smell called
      <code>
       data clump
      </code>
     </p>
    </blockquote>
    <p>
     <strong>
      create a namedtuple
     </strong>
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>

<span class="n">ModelData</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'modin_data'</span><span class="p">,</span> <span class="s1">'sales pricing inventory stored_at min_price start_date end_date'</span><span class="p">)</span>
</code></pre>
    </div>
    <p>
     <strong>
      use the namedtuple
     </strong>
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="n">data</span> <span class="o">=</span> <span class="n">ModelData</span><span class="p">(</span>
    <span class="n">sales</span><span class="o">=</span><span class="n">get_sales</span><span class="p">(),</span>
    <span class="n">pricing</span><span class="o">=</span><span class="n">get_pricing</span><span class="p">(),</span>
    <span class="n">inventory</span><span class="o">=</span><span class="n">get_inventory</span><span class="p">(),</span>
    <span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span>
    <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
    <span class="p">)</span>
</code></pre>
    </div>
    <p>
     <strong>
      refactor functions
     </strong>
     Now that we have a clean data object how do we use it.  Simple, we pass in one data object, then access each attribute with the dot operator. These functions are now much cleaner to call and read.  Here I have chosen a poor name for our
     <code>
      data
     </code>
     , but in a real scenario you may have multple
     <code>
      namedtuples
     </code>
     .
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">calculate_total_revenue</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">sales</span>
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pricing</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'sku'</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">'sku'</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">inventory</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'sku'</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">'sku'</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="n">sales</span><span class="p">[</span><span class="s1">'revenue'</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'qty'</span><span class="p">]</span> <span class="o">*</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'price'</span><span class="p">]</span>
    <span class="n">sales</span>  <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">'price &gt; </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">min_price</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">sales</span>  <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">'sale_date &gt; </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">min_date</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="n">sales</span>  <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s1">'sale_date &lt; </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sales</span><span class="p">[</span><span class="s1">'revenue'</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="o">...</span>
</code></pre>
    </div>
    <p>
     <strong>
      call the function
     </strong>
    </p>
    <p>
     Now that all of the data is store in a single object it is really easy to call each of our functions using one data instance.
    </p>
    <div class="highlight">
     <pre><span></span><code><span class="k">def</span> <span class="nf">make_report</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="s1">'LAX'</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s1">'01-01-1999'</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">'01-01-3000'</span><span class="p">,</span> <span class="n">is_for_steve</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">"""Makes stakeholder report for company XYZ"""</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ModelData</span><span class="p">(</span><span class="n">stored_at</span><span class="o">=</span><span class="n">stored_at</span><span class="p">,</span> <span class="n">min_price</span><span class="o">=</span><span class="n">min_price</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">)</span>

    <span class="n">revenue</span> <span class="o">=</span> <span class="n">calculate_total_revenue</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">sales_ratio</span> <span class="o">=</span> <span class="n">sales_ratio</span> <span class="o">=</span> <span class="n">inventory_sale_ratio</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">inventory_sale_ratio</span> <span class="o">=</span> <span class="n">inventory_sale_ratio</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">predicted_prices</span> <span class="o">=</span> <span class="n">model_new_prices</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">predicted_production_rates</span> <span class="o">=</span> <span class="n">model_production_rate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">completely_custom_metric_for_steve</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># render report</span>
    <span class="o">...</span>
</code></pre>
    </div>
    <h3 id="clean-up-your-data-science">
     üßπ Clean up your data science
     <a alt="id" class="heading-permalink" href="#clean-up-your-data-science" title="link to #clean-up-your-data-science">
      <span class="visually-hidden">
      </span>
      <svg aria-hidden="true" fill="currentColor" focusable="false" height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg">
       <path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z">
       </path>
      </svg>
     </a>
    </h3>
    <p>
     Named Tuples are a great way to clean up your data science code and reduce
     <code>
      Data Clumps
     </code>
     .  Anytime you have multiple data sets that almost always get used together
     <code>
      namedtuple
     </code>
     s are a great way to clean up your code, make it more readable and more maintainable.  If you find that you also have functions that are tightly coupled to this data you might want to consider using a
     <code>
      class
     </code>
     instead of a
     <code>
      namedtuple
     </code>
     , but that is for another article.
    </p>
    <div class="prevnext">
     <style type="text/css">
      :root {
      --prevnext-color-text: #eefbfe;
      --prevnext-color-angle: #ff66c4;
      --prevnext-subtitle-brightness: 3;
    }
    [data-theme="light"] {
      --prevnext-color-text: #1f2022;
      --prevnext-color-angle: #ffeb00;
      --prevnext-subtitle-brightness: 3;
    }
    [data-theme="dark"] {
      --prevnext-color-text: #eefbfe;
      --prevnext-color-angle: #ff66c4;
      --prevnext-subtitle-brightness: 3;
    }
    .prevnext {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      align-items: flex-start;
    }
    .prevnext a {
      display: flex;
      align-items: center;
      width: 100%;
      text-decoration: none;
    }
    a.next {
      justify-content: flex-end;
    }
    .prevnext a:hover {
      background: #00000006;
    }
    .prevnext-subtitle {
      color: var(--prevnext-color-text);
      filter: brightness(var(--prevnext-subtitle-brightness));
      font-size: .8rem;
    }
    .prevnext-title {
      color: var(--prevnext-color-text);
      font-size: 1rem;
    }
    .prevnext-text {
      max-width: 30vw;
    }
     </style>
     <a class="prev" href="/neovim-live-substitution">
      <svg fill="none" height="50px" viewbox="0 0 24 24" width="50px" xmlns="http://www.w3.org/2000/svg">
       <path d="M13.5 8.25L9.75 12L13.5 15.75" stroke="var(--prevnext-color-angle)" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
       </path>
      </svg>
      <div class="prevnext-text">
       <p class="prevnext-subtitle">
        prev
       </p>
       <p class="prevnext-title">
        Live Substitution In Neovim
       </p>
      </div>
     </a>
     <a class="next" href="/my-github-profile">
      <div class="prevnext-text">
       <p class="prevnext-subtitle">
        next
       </p>
       <p class="prevnext-title">
        How I Built My GitHub Profile
       </p>
      </div>
      <svg fill="none" height="50px" viewbox="0 0 24 24" width="50px" xmlns="http://www.w3.org/2000/svg">
       <path d="M10.5 15.75L14.25 12L10.5 8.25" stroke="var(--prevnext-color-angle)" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5">
       </path>
      </svg>
     </a>
    </div>
   </div>
   <hr/>
   <div id="show">
   </div>
  </article>
  <footer>
   <ul class="social">
    <li>
     <a href="https://twitter.com/_WaylonWalker">
      twitter
     </a>
    </li>
    <li>
     <a href="https://www.linkedin.com/in/waylonwalker/">
      LinkedIn
     </a>
    </li>
    <li>
     <a href="https://github.com/WaylonWalker">
      GitHub
     </a>
    </li>
    <li>
     <a href="https://dev.to/waylonwalker">
      Dev.to
     </a>
    </li>
    <li>
     <a href="https://www.twitch.tv/waylonwalker">
      twitch
     </a>
    </li>
   </ul>
   <p>
    ¬© 2019 - 2022
   </p>
  </footer>
 </body>
</html>