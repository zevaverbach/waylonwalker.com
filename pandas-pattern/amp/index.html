<!DOCTYPE html>
<html ⚡ lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width" name="viewport"/>
<link href="/8bitcc.ico" rel="icon" type="image/png"/>
<meta content="$ilp.uphold.com/MGN2ni2YMXaQ" name="monetization" property="monetization"/>
<link href="8bitcc_48x48.png" rel="apple-touch-icon" sizes="48x48"/>
<link href="8bitcc_72x72.png" rel="apple-touch-icon" sizes="72x72"/>
<link href="8bitcc_96x96.png" rel="apple-touch-icon" sizes="96x96"/>
<link href="8bitcc_144x144.png" rel="apple-touch-icon" sizes="144x144"/>
<link href="8bitcc_192x192.png" rel="apple-touch-icon" sizes="192x192"/>
<link href="8bitcc_256x256.png" rel="apple-touch-icon" sizes="256x256"/>
<link href="8bitcc_384x384.png" rel="apple-touch-icon" sizes="384x384"/>
<link href="8bitcc_512x512.png" rel="apple-touch-icon" sizes="512x512"/>
<title>My favorite pandas pattern</title>

<style amp-boilerplate="">body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate="">body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
<style amp-custom="">
        h1{font-weight:700}h1,h2,h3,h4,h5,h6{font-family:"Space Mono",monospace}h1{font-size:2.5em;font-family:"Space Mono",monospace;color:#6a65ca;color:#ff66c4}h2{font-size:1.63rem;color:#d68eba}h3{font-family:"Space Mono",monospace}p{font-family:"Space Mono",monospace;color:rgba(255,255,255,.6);font-size:21px;font-style:normal;font-variant:normal;font-weight:400;line-height:1.5}@media only screen and (max-width:700px){p{font-size:18px}}@media only screen and (max-width:600px){p{font-size:16px}}@media only screen and (max-width:500px){p{font-size:14px}}@media only screen and (max-width:400px){p{font-size:12px}}blockquote{font-family:"Space Mono",monospace}code{font-family:"Space Mono",monospace}pre{font-family:"Segoe UI",Frutiger,"Frutiger Linotype","Dejavu Sans","Helvetica Neue",Arial,sans-serif;font-family:"Space Mono",monospace;font-family:"Space Mono",monospace}a{font-family:"Space Mono",monospace;color:#6f6bae;text-decoration-color:goldenrod}*{box-sizing:border-box}*{font-family:"SF Mono",Monaco,Inconsolata,"Fira Mono","Droid Sans Mono","Source Code Pro",monospace}article,body,div,footer,header,hgroup,html,nav,section{position:relative;display:flex;align-items:center;flex-direction:column;flex-shrink:0}li,p,ul{margin:0;padding:0}p{margin-bottom:1rem}body,html{min-height:100vh;max-width:100%;width:100%;margin:0;padding:2rem;overflow-x:hidden;color:#fafafa;display:flex;padding:0;background-size:800px;min-height:100vh;background:#282c34;background:linear-gradient(81deg,#282c34 0,#3a2e3d 100%)}section{margin-bottom:5rem}h1{color:#ff66c4}ul.archive-list{box-shadow:0 0 2rem rgba(0,0,0,.3),-8rem -6rem 8rem -6rem rgba(253,221,88,.2),4rem 0 8rem rgba(88,82,185,.3),0 0 2rem -1.6rem rgba(255,215,70,.8);margin:0;padding:0;list-style-type:none;margin-top:1rem}li.post{margin:0;width:100%;list-style-type:none;border-width:1px;border-style:solid;border-image:linear-gradient(to right,#ff66c4,rgba(255,102,196,.2)) 1 0 0 0}li.post:nth-child(2n-1){background-color:rgba(255,255,255,.01);background-image:linear-gradient(22deg,rgba(255,255,255,0),rgba(255,255,255,.03))}li.post:nth-child(2n){background-color:rgba(0,0,0,.02);background-image:linear-gradient(22deg,rgba(0,0,0,0),rgba(0,0,0,.03))}li.post a{color:#fafafa;text-decoration:none}li.post h2,li.post p{max-width:800px;width:calc(100vw - 100px)}li.post h2,li.post p{margin-left:2rem;margin-right:2rem}li.post a:focus-visible h2,li.post:hover h2{color:#ff66c4}p{color:#d3d3d3}li.post a:focus-visible p,li.post:hover p{color:#fafafa}nav{padding:1rem 0;align-items:flex-end;max-width:1000px;width:100%}nav ul{list-style-type:none;display:flex}nav ul li{margin:0 .4rem}nav ul li a{text-align:center;color:#dcdcdc;text-decoration:none;padding:.5rem;margin-left:.1rem;margin-right:.1rem;align-items:flex-end}nav ul li a:focus-visible,nav ul li:hover a,ul.archive-tags li a:focus-visible,ul.archive-tags li:hover a{color:#ff66c4}ul.archive-tags{display:flex;justify-content:center;list-style-type:none;color:#dcdcdc;border-bottom:1px solid rgba(255,255,255,.1);margin-bottom:2rem;width:100%}ul.archive-tags li{padding:.2rem 1rem}ul.archive-tags li a{text-decoration:none;color:#fafafa}.social{display:flex}.social li{list-style-type:None}.social a{color:#daa520;padding:1rem .2rem}#cover-wrapper{z-index:2;width:100%;min-height:min(420px,100vw / 2.38)}#cover-wrapper img{width:calc(100% + 2rem);margin:-2rem}#title-wrapper{display:flex;justify-content:flex-end;align-items:flex-end;width:calc(100% + 2rem);left:-1rem;padding:8rem 1rem 0;margin-top:-8rem;margin-bottom:2.2rem;background:linear-gradient(149deg,#282c34 0,rgba(58,46,61,0) 100%);border-bottom:1px solid #daa520}#title-wrapper h1{margin-top:8rem;margin-bottom:0;word-break:break-all}#title-wrapper p{text-align:right;padding-left:0;margin-bottom:0;margin-top:0}#title-wrapper a{color:#daa520;text-decoration:none}#title-wrapper .h-card .content{display:flex;flex-direction:column;align-items:flex-end;margin:1rem 0}.p-note,.post-date{color:rgba(255,255,255,.2)}#title-wrapper a:focus-visible,#title-wrapper a:hover{color:#ff66c4}article.blog-post,div#post-body{display:block}article.blog-post .toc a{padding:.5rem}article.blog-post .toc li{margin:1rem}article.blog-post .toc ul{list-style-type:none;border:none;padding:0;margin:0 0 .5rem}article.blog-post div.toc{margin-bottom:1rem}article.blog-post div.toc:after{content:'';display:block;width:50%;border-bottom:1px solid #daa520}h2.toc{margin-bottom:1rem;text-align:center;color:rgba(255,255,255,.8)}.toc li{margin:1rem}.toc a{color:rgba(255,255,255,.5)}.toc a:focus-visible,.toc a:hover{color:#ff66c4}article.blog-post li>code,article.blog-post p>code{background:rgba(255,20,147,.075);padding:0 .2rem}article.blog-post{overflow:hidden;background:rgba(51,0,38,.13);background:hsla(234,33%,15%,.66);display:block;margin:.2rem;width:min(95vw,1000px);position:relative;margin:2rem 0;padding:1rem;padding-bottom:5rem;border-radius:2px;box-shadow:.2rem .2rem 1rem rgba(0,0,0,.2);flex-direction:column;align-items:flex-start;color:#f5f5f5}@media (max-width:650px){article.blog-post{width:100vw;width:min(100vw,1000px)}}@media (max-width:1200px){article.blog-post h1{font-size:2.5rem;padding:1rem}}@media (max-width:1200px){article.blog-post h2{padding-left:1rem}}@media (max-width:1200px){article.blog-post h3{padding-left:1.4rem}}@media (max-width:1200px){article.blog-post h4,article.blog-post h5,article.blog-post h6{padding-left:1.6rem}}@media (max-width:1200px){article.blog-post{margin:0;padding:0;margin:0}}article.blog-post p{margin:2rem .8rem}@media (max-width:1200px){article.blog-post p{margin:2rem .8rem}article.blog-post ol,article.blog-post ul{padding:1.2rem}}article.blog-post pre{margin-bottom:1rem;align-self:flex-start;max-width:calc(100vw - 20px);padding:10px;overflow-x:auto}article.blog-post .highlight{background:#282c34;padding:1rem;margin:0 -1rem;width:calc(100% + 2rem)}article.blog-post a{color:#6f6bae;text-decoration-color:#330026;text-decoration-color:goldenrod}@media (max-width:1200px){p>img{left:-.8rem}}p>img{position:relative;box-shadow:.2rem .2rem 1rem rgba(51,0,38,.4);max-width:1000px;width:95vw;align-self:center;justify-self:center;align-items:center;justify-items:center;margin:auto;left:-1.6rem}.center-img>img{max-width:600px;margin:.5rem}.center-img{display:flex;justify-content:center}strong{color:#d68fbb;display:inline-block;transform:rotate(-2deg)}em{color:#6f6bae;display:inline-block;transform:rotate(.2deg);background:rgba(255,255,255,.04);padding:.1rem .8rem}h2{margin-top:5rem}article.blog-post ul{border-left:1px solid #ff66c4;padding:.5rem 0 .025rem 3rem;margin:2rem}blockquote{color:#777;background:rgba(255,20,147,.05);border-left:2px solid #daa520;font-size:1rem;padding:1rem 0 1rem .5rem;margin:2rem 0}hr{border:none;border-top:1px solid #daa520;margin:5rem auto;background:0 0;width:min(600px,80%)}h1{margin-top:5rem}.tweet{display:flex;justify-content:flex-end;margin:1rem 0}.tweet a{display:inline-block;border-radius:5px;padding:.5rem 1rem;background:#645fc4;color:#fedd58;text-decoration:none;vertical-align:center}.share{max-width:800px;margin:.8rem auto;padding:1rem 2rem;display:flex;align-items:center;border:1px solid #d68fbb;background-color:rgba(214,143,187,.1);border-radius:5px}.share a{padding:.2rem .5rem}.share p{margin:0;padding:0;padding-right:.2rem}.share ul li{margin:0;padding:0}.shrare ul{display:flex;list-style-type:none;margin:0;padding:0;border:none;font-size:1.3rem}.post-body hr{border-top:2px solid rgba(218,165,32,.2);margin:3rem 40%}.h-card{border-radius:5px;display:flex;align-items:center;justify-content:flex-end}.h-card img{width:50px;border-radius:50%;margin:.2rem;display:none}.h-card ul.social{list-style-type:none;border:none;margin:0;padding:0}.social{display:flex}.social li{list-style-type:None}.social a{color:#daa520;padding:1rem .2rem}.h-card li{margin:0;padding:0}.toc{width:min(90vw,600px);margin:auto;position:initial;font-size:.8rem;line-height:1.1rem}.toc li{padding:0;margin:0}.toc li.H1,.toc li.H2{padding-top:.8rem}.toc li.H3{padding-left:.5rem}.toc li.H4{padding-left:1rem}.toc li.H5{padding-left:1.25rem}.toc li.H6{padding-left:1.5rem}@media (min-width:1500px){.toc{display:none}}.twitter-tweet{margin:10px auto}.onelinelink-wrapper{max-width:100vw}a.onelinelink{position:relative;left:2rem;background:#262236;margin:-6rem auto 1rem;border:2px solid rgba(255,50,50,.1);max-width:300px;border-radius:15px/45px;display:block;flex-direction:row}@media (max-width:350px){a.onelinelink{left:0;margin-left:.4rem;margin-right:.4rem}}@media (min-width:800px){a.onelinelink{max-width:600px;margin:auto}}@media (min-width:900px){a.onelinelink{max-width:700px}}@media (min-width:1000px){a.onelinelink{max-width:800px}}a.onelinelink{position:relative;z-index:2;margin:4rem;overflow:hidden;display:flex;border:2px solid rgba(255,50,50,.1);background:rgba(255,50,50,.015);background:#262236;text-decoration:none;border-radius:8px;max-height:126px}@media (max-width:800px){a.onelinelink{flex-direction:column;max-height:800px;max-width:300px;margin:4rem auto}}a.onelinelink h2{top:-1.2rem;postition:relative;margin:0;padding:0;font-size:.8rem;font-weight:400}a.onelinelink .right{width:calc(100% - 250px - 4rem);padding:5px 15px}@media (max-width:800px){a.onelinelink .right{width:auto}}a.onelinelink .description{font-size:1rem;line-height:1.2rem;height:calc(100% - 31px - 1rem);padding:0;padding-bottom:1rem;padding-top:.1rem;margin:0}a.onelinelink .url{padding-right:30px;color:rgba(255,255,255,.1);text-align:right;position:relative;z-index:2;background:#262236}a.onelinelink img{max-width:300px;max-height:126px;padding:0;margin:0;border-radius:8px 0 0 8px}a.onelinelink .read-more{font-size:.6rem;color:rgba(255,255,255,.08)}table{border-collapse:collapse;margin:auto}table,td,th{border:1px solid rgba(255,255,255,.4);min-width:5rem;padding:.2rem}.speed-control{display:flex;flex-direction:row;justify-content:center;margin-top:-.2rem;padding:1rem 0 .5rem;background:rgba(0,0,0,.3)}.speed-control button{margin:.4;transition:all .2s;border:.1rem solid #d3d3d3;color:#d3d3d3;background:0 0;text-align:center;padding:.35rem 1.2rem;margin:.1rem .5rem;border-radius:.12rem}.speed-control button:hover{color:#000;background:#d3d3d3}body::-webkit-scrollbar{width:1rem}@media (max-width:1000px){body::-webkit-scrollbar{width:.5rem}}@media (max-width:425px){body::-webkit-scrollbar{width:.25rem}}html{scroll-behavior:smooth;scrollbar-width:thin;scrollbar-color:#5651B7}body::-webkit-scrollbar-track{background:#392e3d}body::-webkit-scrollbar-thumb{background-color:#5651b7;border-radius:.25rem;background:#706bd0;background:linear-gradient(180deg,#706bd0 0,#5651b7 100%);border:1px solid rgba(86j,81,183,.5)}
    </style>
<meta content="article" name="og:type" property="og:type"/><meta content="Waylon Walker" name="og:author" property="og:author"/><meta content="Waylon Walker" name="og:site_name" property="og:site_name"/><meta content="#322D39" name="theme-color"/><meta content="Waylon Walker" name="og:author" property="og:author"/><meta content="waylon@waylonwalaker.com" name="og:author_email" property="og:author_email"/><meta content="website" name="og:type" property="og:type"/><meta content="none" name="description" property="description"/><meta content="none" name="og:description" property="og:description"/><meta content="none" name="twitter:description" property="twitter:description"/><meta content="My favorite pandas pattern | Waylon Walker" name="og:title" property="og:title"/><meta content="My favorite pandas pattern | Waylon Walker" name="twitter:title" property="twitter:title"/><meta content="https://images.waylonwalker.com/pandas-pattern-og.png" name="og:image" property="og:image"/><meta content="https://images.waylonwalker.com/pandas-pattern-og.png" name="twitter:image" property="twitter:image"/><meta content="1600" name="og:image:width" property="og:image:width"/><meta content="900" name="og:image:width" property="og:image:width"/><meta content="summary_large_image" name="twitter:card" property="twitter:card"/><meta content="Waylon Walker" name="og:site_name" property="og:site_name"/><meta content="@_waylonwalker" name="twitter:creator" property="twitter:creator"/><meta content="My favorite pandas pattern" name="title" property="title"/><meta content="markata 0.1.0" name="generator" property="generator"/><script async src="https://cdn.ampproject.org/v0.js"></script><link href="https://waylonwalker.com/pandas-pattern/" rel="canonical"/><meta content="https://waylonwalker.com/pandas-pattern/" name="og:url" property="og:url"/></head>
<body>
<nav>
<ul>
<li><a href="/">Home</a></li>
<li><a href="/archive/">Archive</a></li>
<li>
<a aria-label="RSS" href="/rss.xml">
<svg class="icon" height="16" viewbox="0 0 24 24" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M 4 4.44 v 2.83 c 7.03 0 12.73 5.7 12.73 12.73 h 2.83 c 0 -8.59 -6.97 -15.56 -15.56 -15.56 Z m 0 5.66 v 2.83 c 3.9 0 7.07 3.17 7.07 7.07 h 2.83 c 0 -5.47 -4.43 -9.9 -9.9 -9.9 Z M 6.18 15.64 A 2.18 2.18 0 0 1 6.18 20 A 2.18 2.18 0 0 1 6.18 15.64" fill="currentColor">
</path>
</svg>
</a>
</li>
</ul>
</nav>
<article class="blog-post h-entry">
<!-- <div id='cover-wrapper'>
      <img src='/pandas-pattern.webp' alt='cover image for article' />
    </div> -->
<div id="title-wrapper">
<a class="u-url" href="https://waylonwalker.com/pandas-pattern/">
<h1 class="flair" id="title" style="text-align:right;z-index:2;padding-right:.2rem">My favorite pandas pattern
                </h1>
</a>
<p><time class="dt-published post-date" datetime="2018-03-01" style="text-align:right;z-index:2">2018-03-01</time>
</p>
<div class="h-card p-author" rel="author">
<div class="content">
<a class="p-name u-url" href="https://waylonwalker.com/">
<p>
<span class="p-given-name">Waylon</span>
<span class="p-family-name">Walker</span>
</p>
</a>
<p class="p-note">Learning in Public <a href="https://twitter.com/_WaylonWalker">@waylonwalker</a></p>
</div>
</div>
<!-- edit -->
<p><a href="https://github.com/WaylonWalker/waylonwalker.com/edit/main/pages/blog/pandas-pattern.md" title="edit this post">edit<span aria-label="" role="img">✏️</span></a></p>
</div>
<!-- <h2 class='toc'>toc</h2> -->
<!-- -->
<div id="amp-message">
<p style="background: rgba(0,0,0,0.1); padding: .5rem 3rem; margin: 2rem 0rem;">
          ⚡ You've discovered an amp page, if you bump into any issues such as
          syntax highlighting feel free to jump to the <a href="https://waylonwalker.com/pandas-pattern/">normal page</a>
</p>
</div>
<div id="post-body">
<h1 id="my-favorite-pandas-pattern">My favorite pandas pattern</h1>
<p>I work with a lot of transactional timeseries data that includes categories.  I often want to create timeseries plots with each category as its own line.  This is the method that I use almost data to achieve this result.  Typically the data that am working with changes very slowly and trends happen over years not days or weeks.  Plotting daily/weekly data tends to be noisy and hides the trend.  I use this pattern because it works well with my data and is easy to explain to my stakeholders.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">%</span> <span class="n">matplotlib</span> <span class="n">inline</span>
</code></pre></div>
<h2 id="lets-fake-some-data">Lets Fake some data</h2>
<p>Here I am trying to simulate a subset of a large transactional data set. This could be something like sales data, production data, hourly billing, anything that has a date, category, and value.  Since we generated this data we know that it is clean.  I am still going to assume that it contains some nulls, and an irregular date range.</p>
<div class="highlight"><pre><span></span><code><span class="n">n</span> <span class="o">=</span> <span class="mi">365</span><span class="o">*</span><span class="mi">5</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'level_0'</span><span class="p">:</span> <span class="s1">'date'</span><span class="p">,</span>
        <span class="s1">'level_1'</span><span class="p">:</span> <span class="s1">'item'</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s1">'qty'</span><span class="p">,</span> <span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span>
                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'paper'</span><span class="p">,</span> <span class="s1">'pencils'</span><span class="p">,</span> <span class="s1">'note cards'</span><span class="p">,</span> <span class="s1">'markers'</span><span class="p">],</span>
                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">'1/1/2017'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">'d'</span><span class="p">),</span>
                     <span class="p">)</span>
        <span class="o">.</span><span class="n">stack</span><span class="p">()</span>
        <span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">))</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>date</th>
<th>item</th>
<th>qty</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>2017-01-01</td>
<td>paper</td>
<td>1</td>
</tr>
<tr>
<th>1</th>
<td>2017-01-01</td>
<td>pencils</td>
<td>4</td>
</tr>
<tr>
<th>2</th>
<td>2017-01-01</td>
<td>note cards</td>
<td>5</td>
</tr>
<tr>
<th>3</th>
<td>2017-01-01</td>
<td>markers</td>
<td>9</td>
</tr>
<tr>
<th>4</th>
<td>2017-01-02</td>
<td>paper</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
<h2 id="the-pattern">The pattern</h2>
<p>Here I am going to take my groupby date and item, this will take care of duplicate entries with the same time stamp.  Select the value I want to sum on. unstack the items index into columns.  Resample the data by month.  I could easily use any of the <a href="https://pandas.pydata.org/pandas-docs/stable/timeseries.html#offset-aliases">available rules</a>. Fill any missing months with 0, since there wasnt a transaction during that month. Apply a rolling window to get the annual sum.  I find that this helps to ground values in values that my stakeholders are used to seeing on a regular basis and reduces the need for them to recalculate in their head.  Then I am going to drop the nulls created by the rolling window for the first 11 rows.</p>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'date'</span><span class="p">,</span> <span class="s1">'item'</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
             <span class="p">[</span><span class="s1">'qty'</span><span class="p">]</span>
             <span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
             <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">'m'</span><span class="p">)</span>
             <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
             <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
             <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
             <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
             <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
             <span class="p">)</span>
<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>item</th>
<th>markers</th>
<th>note cards</th>
<th>paper</th>
<th>pencils</th>
</tr>
<tr>
<th>date</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-12-31</th>
<td>1543.0</td>
<td>1739.0</td>
<td>1613.0</td>
<td>1657.0</td>
</tr>
<tr>
<th>2018-01-31</th>
<td>1572.0</td>
<td>1744.0</td>
<td>1635.0</td>
<td>1635.0</td>
</tr>
<tr>
<th>2018-02-28</th>
<td>1563.0</td>
<td>1717.0</td>
<td>1645.0</td>
<td>1645.0</td>
</tr>
<tr>
<th>2018-03-31</th>
<td>1596.0</td>
<td>1703.0</td>
<td>1629.0</td>
<td>1600.0</td>
</tr>
<tr>
<th>2018-04-30</th>
<td>1557.0</td>
<td>1693.0</td>
<td>1648.0</td>
<td>1581.0</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">'Rolling annual sum of Categorical Random Data'</span><span class="p">);</span>
</code></pre></div>
<h2 id="for-the-visual-learners">For the Visual Learners</h2>
<h3 id="groupby">Groupby</h3>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span>
             <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">'date'</span><span class="p">,</span> <span class="s1">'item'</span><span class="p">])</span>
             <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
             <span class="p">)</span>
<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th></th>
<th>qty</th>
</tr>
<tr>
<th>date</th>
<th>item</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th rowspan="4" valign="top">2017-01-01</th>
<th>markers</th>
<td>9</td>
</tr>
<tr>
<th>note cards</th>
<td>5</td>
</tr>
<tr>
<th>paper</th>
<td>1</td>
</tr>
<tr>
<th>pencils</th>
<td>4</td>
</tr>
<tr>
<th>2017-01-02</th>
<th>markers</th>
<td>4</td>
</tr>
</tbody>
</table>
</div>
<h3 id="select-values">Select Values</h3>
<p>In this case I chose to do this to avoid working with a multiple levels in the columns that would be created in the unstack() step.</p>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">[</span><span class="s1">'qty'</span><span class="p">]</span>

<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div class="codehilite"><pre><span></span><code>date        item
2017-01-01  markers       9
            note cards    5
            paper         1
            pencils       4
2017-01-02  markers       4
Name: qty, dtype: int32
</code></pre></div>
<h3 id="unstack">unstack</h3>
<p>transform the last column in the index ('item') into rows.</p>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>

<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>item</th>
<th>markers</th>
<th>note cards</th>
<th>paper</th>
<th>pencils</th>
</tr>
<tr>
<th>date</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-01-01</th>
<td>9</td>
<td>5</td>
<td>1</td>
<td>4</td>
</tr>
<tr>
<th>2017-01-02</th>
<td>4</td>
<td>2</td>
<td>3</td>
<td>7</td>
</tr>
<tr>
<th>2017-01-03</th>
<td>9</td>
<td>5</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<th>2017-01-04</th>
<td>2</td>
<td>0</td>
<td>0</td>
<td>5</td>
</tr>
<tr>
<th>2017-01-05</th>
<td>0</td>
<td>1</td>
<td>6</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
<h3 id="resample">resample</h3>
<p>This step is important for irregular data in order to get the data into regular intervals.</p>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">'m'</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>item</th>
<th>markers</th>
<th>note cards</th>
<th>paper</th>
<th>pencils</th>
</tr>
<tr>
<th>date</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-01-31</th>
<td>145</td>
<td>128</td>
<td>117</td>
<td>146</td>
</tr>
<tr>
<th>2017-02-28</th>
<td>136</td>
<td>140</td>
<td>133</td>
<td>135</td>
</tr>
<tr>
<th>2017-03-31</th>
<td>112</td>
<td>145</td>
<td>125</td>
<td>163</td>
</tr>
<tr>
<th>2017-04-30</th>
<td>143</td>
<td>148</td>
<td>112</td>
<td>147</td>
</tr>
<tr>
<th>2017-05-31</th>
<td>86</td>
<td>134</td>
<td>139</td>
<td>141</td>
</tr>
</tbody>
</table>
</div>
<h3 id="rolling">rolling</h3>
<p>I like to use rolling because it get the data into annual numbers, and reduces noise.  I have found that most of my datasets have patterns and trends that are greater than 1y.  This  is just due to the industry that I am in.  Play with the resample and rolling rules to fit the need of your own data.</p>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>item</th>
<th>markers</th>
<th>note cards</th>
<th>paper</th>
<th>pencils</th>
</tr>
<tr>
<th>date</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-01-31</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-02-28</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-03-31</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-04-30</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-05-31</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-06-30</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-07-31</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-08-31</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-09-30</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-10-31</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-11-30</th>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<th>2017-12-31</th>
<td>1543.0</td>
<td>1739.0</td>
<td>1613.0</td>
<td>1657.0</td>
</tr>
<tr>
<th>2018-01-31</th>
<td>1572.0</td>
<td>1744.0</td>
<td>1635.0</td>
<td>1635.0</td>
</tr>
<tr>
<th>2018-02-28</th>
<td>1563.0</td>
<td>1717.0</td>
<td>1645.0</td>
<td>1645.0</td>
</tr>
<tr>
<th>2018-03-31</th>
<td>1596.0</td>
<td>1703.0</td>
<td>1629.0</td>
<td>1600.0</td>
</tr>
<tr>
<th>2018-04-30</th>
<td>1557.0</td>
<td>1693.0</td>
<td>1648.0</td>
<td>1581.0</td>
</tr>
<tr>
<th>2018-05-31</th>
<td>1624.0</td>
<td>1674.0</td>
<td>1632.0</td>
<td>1592.0</td>
</tr>
<tr>
<th>2018-06-30</th>
<td>1582.0</td>
<td>1645.0</td>
<td>1657.0</td>
<td>1593.0</td>
</tr>
<tr>
<th>2018-07-31</th>
<td>1662.0</td>
<td>1654.0</td>
<td>1680.0</td>
<td>1613.0</td>
</tr>
<tr>
<th>2018-08-31</th>
<td>1654.0</td>
<td>1617.0</td>
<td>1650.0</td>
<td>1616.0</td>
</tr>
</tbody>
</table>
</div>
<h3 id="dropna">dropna</h3>
<p>get rid of the first 11 null rows</p>
<div class="highlight"><pre><span></span><code><span class="n">plot_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">plot_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<div>

<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>item</th>
<th>markers</th>
<th>note cards</th>
<th>paper</th>
<th>pencils</th>
</tr>
<tr>
<th>date</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>2017-12-31</th>
<td>1543.0</td>
<td>1739.0</td>
<td>1613.0</td>
<td>1657.0</td>
</tr>
<tr>
<th>2018-01-31</th>
<td>1572.0</td>
<td>1744.0</td>
<td>1635.0</td>
<td>1635.0</td>
</tr>
<tr>
<th>2018-02-28</th>
<td>1563.0</td>
<td>1717.0</td>
<td>1645.0</td>
<td>1645.0</td>
</tr>
<tr>
<th>2018-03-31</th>
<td>1596.0</td>
<td>1703.0</td>
<td>1629.0</td>
<td>1600.0</td>
</tr>
<tr>
<th>2018-04-30</th>
<td>1557.0</td>
<td>1693.0</td>
<td>1648.0</td>
<td>1581.0</td>
</tr>
<tr>
<th>2018-05-31</th>
<td>1624.0</td>
<td>1674.0</td>
<td>1632.0</td>
<td>1592.0</td>
</tr>
<tr>
<th>2018-06-30</th>
<td>1582.0</td>
<td>1645.0</td>
<td>1657.0</td>
<td>1593.0</td>
</tr>
<tr>
<th>2018-07-31</th>
<td>1662.0</td>
<td>1654.0</td>
<td>1680.0</td>
<td>1613.0</td>
</tr>
<tr>
<th>2018-08-31</th>
<td>1654.0</td>
<td>1617.0</td>
<td>1650.0</td>
<td>1616.0</td>
</tr>
<tr>
<th>2018-09-30</th>
<td>1669.0</td>
<td>1648.0</td>
<td>1638.0</td>
<td>1634.0</td>
</tr>
</tbody>
</table>
</div>
<div class="prevnext">

<a class="prev" href="/how-i-deploy-2022">
<svg fill="none" height="50px" viewbox="0 0 24 24" width="50px" xmlns="http://www.w3.org/2000/svg">
<path d="M13.5 8.25L9.75 12L13.5 15.75" stroke="var(--prevnext-color-angle)" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"> </path>
</svg>
<div class="prevnext-text">
<p class="prevnext-subtitle">prev</p>
<p class="prevnext-title">https://waylonwalker.com/how-i-deploy-2022</p>
</div>
</a>
<a class="next" href="/kedro-incremental-versioned-datasets">
<div class="prevnext-text">
<p class="prevnext-subtitle">next</p>
<p class="prevnext-title">Incremental Versioned Datasets in Kedro</p>
</div>
<svg fill="none" height="50px" viewbox="0 0 24 24" width="50px" xmlns="http://www.w3.org/2000/svg">
<path d="M10.5 15.75L14.25 12L10.5 8.25" stroke="var(--prevnext-color-angle)" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
</svg>
</a>
</div>
</div>
<hr/>
<div id="show">
</div>
</article>
<h2>Socials</h2>
<ul class="social">
<li>
<a href="https://twitter.com/_WaylonWalker">twitter</a>
</li>
<li>
<a href="https://www.linkedin.com/in/waylonwalker/">LinkedIn</a>
</li>
<li>
<a href="https://github.com/WaylonWalker">GitHub</a>
</li>
<li>
<a href="https://dev.to/waylonwalker">Dev.to</a>
</li>
<li>
<a href="https://www.twitch.tv/waylonwalker">twitch</a>
</li>
</ul>
</body>
</html>